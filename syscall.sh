#!/bin/bash

# Load target binary into Radare2
r2 /usr/sbin/lighttpd
# Analyse binary
aaa
# Navigate to the main function
s main
# Get the address of the main function
main_address=$(pdf | grep -E '\bmain\b' | awk '{print $1}')
# Generate a script to trigger Syscalls
echo "#!/bin/bash" > syscalls.sh
echo "echo 'Triggering Syscalls...'" >> syscalls.sh
echo "r2 -q0 -c 'db 0x50;pdf @ $main_address'" target_binary >> syscalls.sh
chmod +x syscalls.sh
# Generate a script to trigger Execve
echo "#!/bin/bash" > execve.sh
echo "echo 'Triggering Execve...'" >> execve.sh
echo "echo '/bin/cat /etc/passwd' | r2 -q0 -c 'wa mov rax,0x3b;push rsi;mov rsi,[rsp];xor rdx,rdx;syscall'" target_binary >> execve.sh
chmod +x execve.sh
