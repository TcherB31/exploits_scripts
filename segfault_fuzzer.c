#include <stdio.h>
#include <string.h>
#include <stdlib.h>

#define MAX_LEN 256
int main(int argc, char* argv[]) {
    // Create the command string to run Zsh
    char command[MAX_LEN];
    snprintf(command, MAX_LEN, "zsh -c \"%s\"", argv[1]);
    // Fuzzing loop
    for (int i = 0; i < 100000; i++) {
        // Create the input string with random data
        char input[MAX_LEN];
        for (int j = 0; j < MAX_LEN - 1; j++) {
            input[j] = rand() % 256;
        }
        input[MAX_LEN - 1] = '\0';
        // Append the input string to the command
        strncat(command, " ", MAX_LEN);
        strncat(command, input, MAX_LEN);
        // Run the command
        int result = system(command);
        // Check if a segmentation fault occurred
        if (result != 0) {
            printf("Segmentation fault occurred with input: %s\n", input);
        }
    }
    return 0;
}
