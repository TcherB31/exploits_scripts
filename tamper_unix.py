#!/usr/bin/python

import re
import unicodedata
import base64
from lib.core.enums import DBMS
from lib.core.enums import PRIORITY
__priority__ = PRIORITY.NORMAL

def tamper(payload):
    payload = unicodedata.normalize('NFKD', payload).encode('ascii', 'ignore')
    match = re.search(r'\[BASE64\].*\[/BASE64\]', payload)
    if match:
        encoded_string = match.group(0)
        decoded_string = encoded_string.replace('[BASE64]', '').replace('[/BASE64]', '')
        encoded_string = '[BASE64]' + base64.b64encode(decoded_string.encode('utf-8')).decode('utf-8') + '[/BASE64]'
        payload = payload.replace(match.group(0), encoded_string)
    return payload.decode("ascii")
